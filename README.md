# procon26

かいはつちう

## To build:

必要なもの:

  * dmd 2.067.0 or later
  * dub 0.9.22 or later

以下を実行するとコンパイルされ自動で実行される:

```sh
dub
```

以下のコマンドだとコンパイル時最適化が行われる:

```sh
dub --build=release
```

詳しくはdubのリファレンス等を参照。

## Memo

2015-05-24 15:25 現状, stone構造体とfield構造体を定義しただけ。実行してもテストコードが走るのみ。たんさくがんばる

2015-05-25 00:38 immutable構造体はオワコンらしいので構造体やめて素の配列にした。とりあえずMeuAI(愚直深さ優先探索)がひと通りできたっぽい。でもなんかコンパイル時最適化有効にすると結果変わるんだけど……不穏だめう

2015-07-26 20:31 どうしたらいいんだろうか(((((
初めに入力の盤面と石の大きさ・形などを解析して, この問題がどれくらいの規模か・極端に大きい石や複雑な石はないか・置ける場所が限られる石はないか, などを見極める。その情報を元に最適な探索アルゴリズムを回す。みたいな感じかなー

2015-08-25 20:49 とりあえず適当に書いた深さ優先探索のコードは隔離して, 新しくちゃんと設計しつつ書き直す。いいモジュール名思いつかなかったからcharlotteにした

2015/09/23 17:01 charlotte.DFSを一通り実装した。対称な形の石では反転・回転動作を枝刈りするし, ノードを開く処理は並列化した。また, 64bitでもコンパイルできるようにもした。ldc2-0.16.0-alpha4-win64-msvcでの動作を確認。dmdで32bitコンパイルするより3倍くらいはやい。これは強そうだ。

2015/09/23 22:36 ふと思いついてcharlotte.RandomBeamを実装した。非常に単純な乱択アルゴリズムだが, 場合によっては割と使える事が判明。途中で探索を打ち切れば, 解の方向性をざっと決めるのにも使えそう。(追記: (原始)モンテカルロ法, MCというアルゴリズムらしい。リネームした)

2015/10/04 17:50 モンテカルロ木探索を実装したり, コピペっぽいところを一つにまとめたりと色々もそもそした。ひとつ目の石から順に探索するだけでは限界が見えてきた。問題に含まれる石の中で特に配置が重要なものを検出して, そこから順に探索を進める感じのアプローチを考え中。

#### charlotteの設計メモ (最終更新: 2015/09/23)
- 型定義
  - charlotte.problemtypes
    - Stone型, Field型
      - 単純なbool型の配列で持つのが無難か?
      - int型等の配列にして探索中に色々なデータを持たせるのもアリか
  - charlotte.answertypes
    - Operation型
      - 回答データの一行分のデータと, ひとつ前のOperationへの参照を持つ。クラス。
    - Place型
      - 一つの石を置く場所を表す。flip[表, 裏], rotate[0, 90, 180, 270], x[-7~38], y[-7~38] の構造体。
    - Rotation型
      - 回転角。deg0, deg90, deg180, deg270 の列挙型。
- Analyze
  - 対称な形の石は, 異なる操作をしても同じ配置になることがある
    - よって, 探索ノード数を削減できる
  - それぞれの石・敷地について, ずく数, 近傍マス数, 幅, ...などの探索のヒントになりそうな値を求める
  - 求めた値はStoneAnalyzed構造体にまとめて保持する
  - 敷地を部分ごとに分解するとかも
- Search
  - DFS(深さ優先探索)
    - 再帰による実装だとスタックオーバーフローっぽいエラーが出て死んだので, スタックを用いた実装にした。以前と挙動が違うため, 最初の回答が出てくるまでが遅い。
    - 一つのNodeから次のNodeを生成する処理が結構重いため, 並列化が有効?
      - やってみたけどそんなに速くならないっぽい 目視1.5倍くらい
  - MC(原始モンテカルロ法)
    - 石を置けるところにランダムに置いていき, 最後の石まで終わったらそれを回答とする。これを繰り返すのみ。バックトラック等の処理は行わない。
    - CPUのそれぞれのスレッドで独立に探索する。ハイスコアを更新する回答を見つけたらそれを出力する。
    - 細長い敷地の問題で割りと有効。
  - MCTS(モンテカルロ木探索)
    - 原始モンテカルロ法に木探索を組み合わせたアルゴリズム。詳しくはググるかSlackを参照。
    - 問題によっては非常に効果があるが, 今回のプロコン問題とはあまり相性が良くないっぽい? プレイアウトに時間が掛かり過ぎて十分な試行回数が得られない
- Idea
  - 石を置く場所を決めるのに評価関数を導入する
  - 後ろから探索するとどうなる?
    - 条件が複雑になって死ぬ
  - 探索中, 特にずく数が小さい石については配置を確定せず保留し, あとで隙間を埋めるのに使う
